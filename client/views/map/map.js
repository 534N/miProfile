var details = {
  '2013': {
    'description': 'Wanting to become an application developer at Shopify',
    'time': 'Now',
    'avatar': 'http://cdn.shopify.com/s/files/1/0249/7745/t/1/assets/shopify.png',
    'popup': '<p><i class="ss-target"></i> Shopify</p> <p>I spent 6 years in a Telecommunication company, building web applications as the so called "the tools guy"... the minorities. </p> <p>To prove that I could become the majority, I got ALU 3RP certification, made my way to become an IP expert. </p> <p> However the passioin in web application development has never been bigger and "the tools guy" position is falling short of space for me to be who I really am. </p> <p>My friends who worked at or knows about Shopify recommended me to give it a try. So I did, then I immediately realized that I just found the end of the tunnel. </p>',
    'lat': 45.42891179999999, 
    'lon': -75.69028650000001
  },
  '2012': {
    'description': 'Nearest',
    'time': 'June, 2012',
    'popup': '<p><i class="ss-medal"></i>Started contract work as Lead Developer at Nearest</p> <p><i class="ss-medal"></i>Innovated and prototyped location based community with Google Map API v3 and Joomla 2.5, Built the beta version with Meteor.js</p> <p><i class="ss-medal"></i> Built TS Helper for 7x50 Service Router customers (i.e. AT&T, Version Wireless, China Telecom, etc.) using Laravel 3.2.5 </p>',
    'lat': 45.4008857, 
    'lon': -75.71086919999999
  },
  '2011': {
    'description': '<i class="ss-heart"></i>',
    'time': 'November 21, 2011',
    'popup': '<p><i class="ss-heart"></i> Married to Sophie</p>',
    'lat': 45.3217356, 
    'lon': -75.93338010000002
  },
  '2010': {
    'description': 'Ramping up with IP knowledges, customer support experience and troubleshooting skills',
    'time': 'September 30, 2010',
    'popup': '<p><i class="ss-garage"></i> Bought a house </p><p><i class="ss-medal"></i> Got a dog - Newfie cross lab - named him Marley. </p>',
    'lat': 45.3217356, 
    'lon': -75.93338010000002
  },
  '2009': {
    'description': 'Built Health Check Tool for 7x50 Service Router in PHP, MySQL, Javascript.',
    'time': 'January, 2009',
    'popup': '<p><i class="ss-medal"></i> Got a raise! </p> <p><i class="ss-medal"></i> This tool has been the used hundreds of times everyday by over 1200 users world wide till today! </p> <p><i class="ss-heart"></i> Met Sophie</p>',
    'lat': 45.3485605, 
    'lon': -75.92212369999999
  },
  '2008': {
    'description': 'Got enough with snowboarding',
    'time': 'December, 2008',
    'popup': '<p><i class="ss-snowflake"></i> Certified Level 1 Snowboard instructor</p><p><i class="ss-snowflake"></i> Crashed into snowbank after giving the first class.</p><p><i class="ss-snowflake"></i> Dislocated right elbow a week after been certified, won the nastiest injuries of the night at Civic Hospital! </p>',
    'lat': 45.5090169, 
    'lon': -75.85122419999999
  },
  '2007': {
    'description': 'Started full-time work at Alcatel-lucent',
    'time': 'Feburary, 2007',
    'popup': '<p><i class="ss-medal"></i> Developed regression test system extensions in TCL, PHP, Javscripts. </p>',
    'lat': 45.3485605, 
    'lon': -75.92212369999999
  },
  '2006': {
    'description': 'Graduated From Carleton University',
    'time': 'December, 2006',
    'popup': '<p><i class="ss-medal"></i> Bachelor of Computer Science with High Honors</p>',
    'lat': 45.3875812, 
    'lon': -75.69602020000002
  },
  '2005': {
    'description': 'Co-op job at Alcatel',
    'time': 'January 5, 2005',
    'popup': '<p><i class="ss-medal"></i> Built regression test monitoring system in PHP.</p><p> This very system has been heavily relied on by the all 7x50 profolio R&D teams till today!</p> <p>Received HighFive honor from Vice President of 7750 Product Department.</p> <p>Received a job offer at Alcatel for after graduation.</p> <p> <i class="ss-info"></i> 7x50 profolio products have been generating billions $ revenue every year since 2004.</p>',
    'lat': 45.3485605, 
    'lon': -75.92212369999999
  },
  '2004': {
    'description': 'Got the first co-op job at Carleton University',
    'time': 'January 5, 2004',
    'popup': '<p><i class="ss-suitcase"></i> CCS Department</p>',
    'lat': 45.3875812, 
    'lon': -75.69602020000002
  },
  '2003': {
    'description': 'Went to U.S to work in resturants. Made $8000 US cash for tuition fees',
    'time': 'May 2 - August 28, 2003',
    'geometry': [
      	{
          	'popup': 'New Jersey - 1st waitor job in my life... Took 1 hour train to get here and got fired in 3 days... -_- ',
          	'lat': 40.0583238, 
    		'lon':-74.4056612
        },
      	{
          	'popup': 'Ohio - 2nd waitor job in my life... Took 16 hour bus to get here and got fired in 3 days... AGAIN!  >_<',
          	'lat': 40.4172871, 
    		'lon': -82.90712300000001
        },
      	{
          	'popup': 'West Virginia - 3rd time, I learned, took a "bus boy" position with less pay... luckily the boss liked me because I fixed his laptop for him... ^_^',
          	'lat': 38.5976262, 
    		'lon': -80.45490259999997
        },
      	{
          	'popup': 'Pennsylvania - 4th one, becoming an experienced waitor, seating customers, taking orders, taking calls, collecting dishes, cashier, etc... *_*',
          	'lat': 41.2033216, 
    		'lon': -77.19452469999999
        },
      	{
          	'popup': 'New York - Every time I got fired, I came back here to get a new job in job agencies in China Town...',
          	'lat': 40.7143528, 
    		'lon': -74.0059731
        },
    ]
    
  },
  '2001': {
    'description': 'Carleton University ',
    'time': 'September 1, 2001',
      'popup': '<p><i class="ss-openbook"></i> First year in Computer Science at Carleton University...</p><p> 200 students in one Java class...</p> <p> ... and why is it called Java anyways ... >_<...</p>',
    'lat': 45.3875812, 
    'lon': -75.69602020000002
  },
  '2000': {
    'description': 'Came to Ottawa, Ontario, Canada and studied English at Carleton University',
    'time': 'May 22, 2000',
      'popup': '<i class="ss-departure"></i> Ottawa International Airport',
    'lat': 45.3178437, 
    'lon': -75.66588539999998
  },
  '1981': {
    'description': 'Borned in Kunming, Yunnan Province, China',
    'time': 'November, 20, 1981',
      'popup': '<p><i class="ss-heart"></i> Home Town</p> <p>Grew up wanting to be an actor or artist...</p>',
    'lat': 24.88, 
    'lon': 102.83
  }
}



Meteor.startup(function() {

	var map = L.map('map').setView([ 45.42891179999999, -75.69028650000001], 13);
			
	L.tileLayer('http://{s}.tile.cloudmade.com/{key}/60352/256/{z}/{x}/{y}.png', {
	    // attribution: 'Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2012 CloudMade',
	    key: 'BC9A493B41014CAABB98F0471D759707'
	}).addTo(map);

	$.markers = {};
        
    for (var time in details) {
      	var obj = details[time];
      	if (obj.hasOwnProperty('geometry')) {
      		for (var i=0; i<obj.geometry.length; i++) {
      			var marker = new L.Marker(new L.LatLng(obj.geometry[i].lat, obj.geometry[i].lon), {
              	}).addTo(map).bindPopup(obj.geometry[i].popup);
    		}
    	} else {
            if (obj.hasOwnProperty('avatar')) {
                var marker = new L.Marker(new L.LatLng(obj.lat, obj.lon), {
                    icon:	new L.NumberedDivIcon({avatar: obj.avatar})
                }).addTo(map).bindPopup(obj.popup);
            } else {
                var marker = new L.Marker(new L.LatLng(obj.lat, obj.lon), {
                }).addTo(map).bindPopup(obj.popup);
            }
        }
      
      	$.markers[time] = marker;
    }

    $(function() {
      $(document).ready(function(e){
      	var key 	= $('#active').attr('key');
        var zoom 	= $('#active').attr('zoom');
        map.setView([$.markers[key]._latlng.lat, $.markers[key]._latlng.lng], zoom, {zoom: {animate: true}}, {pan: {animate: true}});
        $.markers[key].openPopup();
        $('#timeline_description').html('<i class="ss-clock"></i>&nbsp;&nbsp;' + details[key].time);
        $('#memos').html('<i class="ss-clock"></i>&nbsp;&nbsp;' + details[key].description);
        
      });
      $('.timeline_entry').click(function(e) {
        $('#active').removeAttr('id');
        
        var lat  = $(e.target).attr('lat');
        var lon  = $(e.target).attr('lon');
        var zoom = $(e.target).attr('zoom');
        var key  = $(e.target).attr('key');
		
        if (lat && lon) { 
        	map.setView([lat, lon], zoom, {zoom: {animate: true}}, {pan: {animate: true}});
        } else {
          	map.setView([$.markers[key]._latlng.lat, $.markers[key]._latlng.lng], zoom, {zoom: {animate: true}}, {pan: {animate: true}});
        }
        $(e.target).attr('id', 'active');
        $('#timeline_description').html('<i class="ss-clock"></i>&nbsp;&nbsp;' + details[key].time);
        $('#memos').html('<i class="ss-clock"></i>&nbsp;&nbsp;' + details[key].description);
        
        $.markers[key].openPopup();
      }); 
    });
});





